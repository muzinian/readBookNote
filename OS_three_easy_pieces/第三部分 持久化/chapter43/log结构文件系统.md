## log结构文件系统
在二十世纪90年代早期，在Berkeley由John Ousterhout和研究生Mendel Rosenblum领导的一个研究小组开发了一个新的文件系统：log结构文件系统。这样做的动机是基于如下观察：
* __系统内存在增长：__ 随着内存越大，可以在内存中缓存的数据越多。越多的数据被缓存，硬盘流量的增长逐渐是有写操作组成的，因为读是缓存提供服务的。因此，文件系统性能大部分是由它的写操作性能决定了。
* __随机I/O性能和顺序I/O性能之间有巨大的间隙：__ 硬盘驱动传输带宽这些年增长迅速；更多的bit被封装到了驱动的表面，访问这些bit时带宽增加了。寻道和旋转延时开销很大，然而，下降的很慢；让便宜小巧的马更快的旋转磁盘或者更快的移动硬盘臂具有挑战性。因此，如果你有能力可以顺序使用硬盘，相比于那些导致寻道或和旋转的方式，你就获取了可测量的性能提升。
* __已存在的文件系统在很多常见工作集上工作的很糟糕：__ 例如，FFS创建一个block大小的文件需要执行大量的写操作；一次写新的inode，一次更新inode位图，一次写包含文件的目录数据block，一次更新这个目录的inode，一次写这个新文件的新数据block，一次写数据位图标识这个数据块被分配了。因此，尽管FFS把所有这些blocks都放到同一个blcok组里，FFS导致很多小的寻道以及后续的旋转延时从而性能相对峰值顺序带宽急剧下降。
* __文件系统对RAID无意识(no RAID-aware)：__ 例如，RAID-4和RAID-5都有 __小尺寸写问题(small-write problem)__ ：一个逻辑写单个block导致4次物理I/O的发生。已存在的文件系统没有尝试避免这个最糟糕的RAID写行为情况。

一个理想的文件系统应该关注写性能，并尝试利用硬盘的顺序写入带宽。更进一步，它在常见的工作集上工作的很好，不仅仅是写入数据，还有频繁的更新硬盘元数据结构。最后，它在RAID上工作的要跟在单个硬盘上一样好。
>#### tip：细节很重要
>所有有意思的系统都是由少数通用概念和很多细节组成的。有时候，当你学习这些系统时，你认为你自己“我知道了大体的概念了，剩下的都是细节了”，你用这种方式只学习了一半关于事情如何真正工作的。不要这样做！很多次，细节是关键。正如我们在LFS中看到的，大体的概念很容易理解，但是真正构建一个可以工作的系统，你需要考虑说有麻烦的情况。

Rosenblum和Ousterhout引入的新型文件系统叫做  __LFS__，是 __Log结构文件系统(Log-structured File System)__ 的简称。当写入到硬盘时，LFS首先在内存中的 __段(segment)__ 缓冲所有更新(包括元数据!)；当这个段满了，就把它以长的，顺序的传输方式写入到硬盘中没有使用的部分中(it is written to disk in one long ,sequential transfer to an unused part of the disk)。LFS绝不会覆写存在的数据，总是把段写入到空闲的位置。由于段很大，硬盘(或者RAID)就被高效的使用了，文件系统的性能就接近它的峰值。
>#### 症结：如果让所有的写都是顺序写？
>文件系统如何把所有写操作都转换为顺序写？对于读，这个任务是不可能的，因为需要读取的block可能在硬盘的任意位置。对于写，文件系统总是有选择的，这中选择就是我们要揭示的。
